# Сайт: www.picoctf.org
# Название: packer
# Автор: Mubarak Mikail
# Сложность: Medium

#### Шаг 1. Определяем упаковщик.
Решим несложную задачу с сайта picoCTF. Для того, чтобы ее решить нам сначала потребуется ее распаковать. Если 
открыть нераспакованый файл в IDA Pro, то увидим, что дизассемблер не смог ничего распознать. Для 
того, чтобы распаковать файл нам потребуется определить какой упаковщик был использован. 

![image](https://github.com/user-attachments/assets/14e811db-9f40-4d95-9d52-7c292c874f27)

Сделаем это с помощью утилиты Detect It Easy(DIE). 

![image](https://github.com/user-attachments/assets/888867c5-99a0-439f-87fc-c74778fb0042)

#### Шаг 2. Распаковываем бинарный файл.
Увидим, что использовался популярный упаковщик UPX. Пройдем в директорию, где лежит упаковщик и передадим ему путь к файлу с аргументом -d, что означает 
decompress.\
![image](https://github.com/user-attachments/assets/4d221d06-9704-47fe-b309-3c7de7572acc)
![image](https://github.com/user-attachments/assets/f543bf95-1ccb-4868-830f-772936f2e78d)


#### Шаг 3. Изучаем алгоритм работы программы.

Сразу видим большую подсказку ввиде непонятных чисел, что говорит нам о том, что это скорее всего строка записанная в виде hex. 
![image](https://github.com/user-attachments/assets/3eca55a3-35ee-4e7d-b6fb-4037e854348c)\
Данная строка лежит в переменной var_80. Переименуем эту переменную в pswd.

![image](https://github.com/user-attachments/assets/2791c314-c7bf-40cb-8758-5df58c44f26b)\
Далее видим две переменные var_98 и var_88, а также функцию `strncmp()`.
Данная функция сравнивает ascii-символы до n-го символа. Аргументы данной функции 
передаются в регистры rcx и в rax, так как в rcx передается адрес пароля, то в rax var_88 это вводимый пароль пользователем, следовательно var_98 это n. Теперь осталось
понять, как решить задачу.

#### Способ 1.
Можно было банально посмотреть в список строк в IDA Pro нажав Shift-f12. Найти hex'овую строку и закинуть ее в конвертор.
#### Способ 2. 
Отдебажить программу, найти n и ввести строку. 
#### Примечание 
К сожалению, строку сразу в программе и получить флаг не получится. Поэтому вводите с помощью командного интерпретатора следующим образом
`printf "7069636f4354467b5539585f556e5034636b314e365f42316e34526933535f35646565343434317d" | ./out`
#### Способ 3. 
Патчинг программы. Исправить jnz на jz. Получаем флаг и закидываем в hex. 

Я использую третий способ. (Патчинг был объяснен в задании XOR Crackme)
![image](https://github.com/user-attachments/assets/e105c189-3abb-412c-a54d-598d402753f2)

И с помощью языка программирования python получим флаг. 
![image](https://github.com/user-attachments/assets/915120a2-675f-46f3-a3f9-3d406db5c715)

Ответ: `picoCTF{U9X_UnP4ck1N6_B1n4Ri3S_5dee4441}`

Вывод: Флаг найден и задача выполнена. Однако, данная задача на уровень Medium, на мой лично взгляд не тянет.


