
# Сайт: PicoCTF
# Задание: reverse_cipher
# Автор: Danny Tunitis 
# Сложность: Hard


Разберем задачу уровня сложности `Hard` с `.PicoCTF`. В задаче сказано разобрать работу бинарного файла и восстановить текоствый файл.
![image](https://github.com/user-attachments/assets/567553b0-0a19-4230-8df9-3fb86e7eadf6)
Традиционно начинаем статически анализировать программу :). 

#### Статический анализ.

![image](https://github.com/user-attachments/assets/d8fb592c-1745-41ad-9c45-0cbaa1539ab2)

Бинарный файл сразу же встречает нас открытием двух файлов `flag.txt` и `rev_this` с помощью функции `_fopen` профиль которой выглядит следующим 
образом: 
```c
FILE *fopen(const char *restrict pathname, const char *restrict mode);
```

В качестве параметров ей передается путь к файлу и режим с помощью которых мы открываем данные файлы. Вот некоторые из них: 
| Режим | Значение |
| :----- | :------- |
|   r    | На чтение |
|   w    | На запись | 
|  rw    | На чтение и запись |
|   a    | Открывает файл на запись и если его не существует, создает его, записывает данные в конец|

А возвращает функция указательна структуру `FILE`.
Исходя из этой таблицы посмотрим еще раз на бинарный файл и посмотрим каким образом открываются файлы. Файл `flag.txt` открывается только на чтение, а файл `rev_this` на запись.
В случае, если файлы открыть не удалось `_fopen` в обоих случаях вернет `NULL`. В таком случае, отработают следующие ветки программы:
![image](https://github.com/user-attachments/assets/a71776bf-f660-456c-b894-1dbc36523cbc)

Указатель, который вернется после открытия файла `flag.txt` хранится по смещению `[rbp+stream]` или `[rbp-0x18]`. Переименуем его в `[rbp+flag_file_ptr]`, а `[rbp+var_20]` в `[rbp+rev_file_ptr]` для того, чтобы нам было удобнее их различать в будущем.


